<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Equity Funds - MF Analyzer</title>

    <!-- Bootstrap 5.3.8 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background-color: #f9fafb;
        padding-top: 60px;
      }

      /* Sticky Header */
      .top-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background-color: #ffffff;
        border-bottom: 1px solid #e5e7eb;
        z-index: 1030;
        padding: 12px 16px;
      }

      .logo-symbol {
        width: 36px;
        height: 36px;
        background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 18px;
      }

      .site-name {
        font-size: 18px;
        font-weight: 600;
        color: #111827;
        margin: 0;
      }

      .back-btn {
        background: none;
        border: none;
        padding: 8px;
        cursor: pointer;
        color: #6b7280;
      }

      .back-btn:hover {
        color: #2563eb;
      }

      /* Filter Tabs */
      .filter-section {
        background: #ffffff;
        border-bottom: 1px solid #e5e7eb;
        position: sticky;
        top: 60px;
        z-index: 1020;
      }

      .filter-tabs {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }

      .filter-tabs::-webkit-scrollbar {
        display: none;
      }

      .filter-btn {
        padding: 12px 20px;
        border: none;
        background: none;
        color: #6b7280;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        white-space: nowrap;
        border-bottom: 2px solid transparent;
        transition: all 0.2s;
      }

      .filter-btn:hover {
        color: #2563eb;
      }

      .filter-btn.active {
        color: #2563eb;
        border-bottom-color: #2563eb;
      }

      /* Category Pills */
      .category-pills {
        padding: 12px 16px;
        background: #ffffff;
        border-bottom: 1px solid #e5e7eb;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }

      .category-pills::-webkit-scrollbar {
        display: none;
      }

      .category-pill {
        padding: 8px 16px;
        border: 1px solid #e5e7eb;
        border-radius: 20px;
        background: #ffffff;
        color: #6b7280;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        white-space: nowrap;
        transition: all 0.2s;
      }

      .category-pill:hover {
        border-color: #2563eb;
        color: #2563eb;
      }

      .category-pill.active {
        background: #eff6ff;
        border-color: #2563eb;
        color: #2563eb;
      }

      /* Fund Card */
      .fund-card {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        transition: all 0.2s;
      }

      .fund-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border-color: #d1d5db;
      }

      .fund-name {
        font-size: 15px;
        font-weight: 600;
        color: #111827;
        margin-bottom: 6px;
        line-height: 1.4;
      }

      .fund-type {
        font-size: 12px;
        color: #6b7280;
        margin-bottom: 12px;
      }

      .fund-metrics {
        display: flex;
        gap: 16px;
        margin-bottom: 12px;
        flex-wrap: wrap;
      }

      .metric {
        flex: 1;
        min-width: 80px;
      }

      .metric-label {
        font-size: 11px;
        color: #9ca3af;
        margin-bottom: 4px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .metric-value {
        font-size: 16px;
        font-weight: 700;
        color: #111827;
      }

      .metric-value.positive {
        color: #059669;
      }

      .metric-value.negative {
        color: #dc2626;
      }

      .risk-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        margin-bottom: 12px;
      }

      .risk-low {
        background: #d1fae5;
        color: #065f46;
      }

      .risk-moderate {
        background: #fef3c7;
        color: #92400e;
      }

      .risk-high {
        background: #fee2e2;
        color: #991b1b;
      }

      .fund-actions {
        display: flex;
        gap: 8px;
      }

      .action-btn {
        flex: 1;
        padding: 10px 16px;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        background: #ffffff;
        color: #374151;
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }

      .action-btn:hover {
        background: #f9fafb;
        border-color: #2563eb;
        color: #2563eb;
      }

      .action-btn.primary {
        background: #2563eb;
        color: #ffffff;
        border-color: #2563eb;
      }

      .action-btn.primary:hover {
        background: #1e40af;
      }

      /* Loading & Empty States */
      .loading-spinner {
        text-align: center;
        padding: 40px;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
      }

      .empty-icon {
        font-size: 48px;
        color: #d1d5db;
        margin-bottom: 16px;
      }

      .empty-text {
        font-size: 15px;
        color: #6b7280;
      }

      /* Stats Banner */
      .stats-banner {
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
      }

      .stat-item {
        text-align: center;
      }

      .stat-value {
        font-size: 20px;
        font-weight: 700;
        color: #1e40af;
      }

      .stat-label {
        font-size: 12px;
        color: #6b7280;
        margin-top: 4px;
      }

      @media (max-width: 767px) {
        body {
          padding-top: 60px;
        }

        .fund-actions {
          flex-direction: column;
        }

        .action-btn {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <!-- STICKY HEADER -->
    <header class="top-header">
      <div class="d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center gap-3">
          <button
            class="back-btn"
            onclick="window.location.href='/home-bootstrap.html'"
          >
            <i class="bi bi-arrow-left" style="font-size: 20px"></i>
          </button>
          <h1 class="site-name">Equity Funds</h1>
        </div>
        <div class="logo-symbol">MF</div>
      </div>
    </header>

    <!-- FILTER TABS (Top 25/50/100) -->
    <div class="filter-section">
      <div class="filter-tabs">
        <div class="d-flex">
          <button class="filter-btn active" data-filter="all">All Funds</button>
          <button class="filter-btn" data-filter="top25">Top 25</button>
          <button class="filter-btn" data-filter="top50">Top 50</button>
          <button class="filter-btn" data-filter="top100">Top 100</button>
        </div>
      </div>
    </div>

    <!-- CATEGORY PILLS (Sub-categories) -->
    <div class="category-pills">
      <div class="d-flex gap-2">
        <button class="category-pill active" data-category="all">All</button>
        <button class="category-pill" data-category="large-cap">
          Large Cap
        </button>
        <button class="category-pill" data-category="mid-cap">Mid Cap</button>
        <button class="category-pill" data-category="small-cap">
          Small Cap
        </button>
        <button class="category-pill" data-category="multi-cap">
          Multi Cap
        </button>
        <button class="category-pill" data-category="flexi-cap">
          Flexi Cap
        </button>
        <button class="category-pill" data-category="elss">ELSS</button>
        <button class="category-pill" data-category="sectoral">Sectoral</button>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <main
      class="container-fluid px-3"
      style="max-width: 1200px; margin: 0 auto"
    >
      <!-- Stats Banner -->
      <div class="stats-banner mt-3">
        <div class="row g-3">
          <div class="col-4">
            <div class="stat-item">
              <div class="stat-value" id="totalFunds">0</div>
              <div class="stat-label">Total Funds</div>
            </div>
          </div>
          <div class="col-4">
            <div class="stat-item">
              <div class="stat-value" id="avgReturn">0%</div>
              <div class="stat-label">Avg 3Y Return</div>
            </div>
          </div>
          <div class="col-4">
            <div class="stat-item">
              <div class="stat-value" id="topPerformer">-</div>
              <div class="stat-label">Best Performer</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Fund List -->
      <div id="fundList">
        <!-- Loading State -->
        <div class="loading-spinner">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <p class="mt-3 text-muted">Loading funds...</p>
        </div>
      </div>
    </main>

    <!-- Bootstrap 5.3.8 JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>

    <script>
      // API Configuration
      const API_URL = 'http://localhost:3002/api';
      let allFunds = [];
      let currentFilter = 'all';
      let currentCategory = 'all';

      // Fetch real funds from API
      async function fetchFunds() {
        try {
          const response = await fetch(`${API_URL}/funds`);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const result = await response.json();
          const data = result.data || result; // Handle wrapped response

          // Transform API data to match our format
          allFunds = data.map((fund) => ({
            id: fund._id,
            name: fund.name,
            type: fund.subCategory || fund.category || 'Equity Fund',
            category: mapCategory(fund.category, fund.subCategory),
            nav: fund.currentNav || fund.navValue || fund.nav || 0,
            return1Y:
              fund.returns?.oneYear ||
              fund.returns?.['1Y'] ||
              fund.return1Y ||
              0,
            return3Y:
              fund.returns?.threeYear ||
              fund.returns?.['3Y'] ||
              fund.return3Y ||
              0,
            return5Y:
              fund.returns?.fiveYear ||
              fund.returns?.['5Y'] ||
              fund.return5Y ||
              0,
            riskLevel: mapRiskLevel(fund.riskLevel || fund.risk),
            aum: fund.aum || 0,
            expenseRatio: fund.expenseRatio || 0,
          }));

          // Sort by 3Y return for ranking
          allFunds.sort((a, b) => b.return3Y - a.return3Y);

          renderFunds();
        } catch (error) {
          console.error('Error fetching funds:', error);
          document.getElementById('fundList').innerHTML = `
            <div class="empty-state">
              <div class="empty-icon"><i class="bi bi-exclamation-triangle"></i></div>
              <div class="empty-text">Unable to load funds. Please make sure the backend server is running on port 3002.</div>
            </div>
          `;
        }
      }

      function mapCategory(category, subcategory) {
        const sub = (subcategory || '').toLowerCase();
        const cat = (category || '').toLowerCase();

        if (sub.includes('large') || cat.includes('large')) return 'large-cap';
        if (sub.includes('mid') || cat.includes('mid')) return 'mid-cap';
        if (sub.includes('small') || cat.includes('small')) return 'small-cap';
        if (sub.includes('multi') || cat.includes('multi')) return 'multi-cap';
        if (sub.includes('flexi') || cat.includes('flexi')) return 'flexi-cap';
        if (sub.includes('elss') || cat.includes('elss') || sub.includes('tax'))
          return 'elss';
        if (
          sub.includes('sector') ||
          cat.includes('sector') ||
          sub.includes('thematic')
        )
          return 'sectoral';

        return 'all';
      }

      function mapRiskLevel(risk) {
        const riskStr = (risk || '').toLowerCase();
        if (riskStr.includes('high') || riskStr.includes('very high'))
          return 'high';
        if (riskStr.includes('moderate') || riskStr.includes('medium'))
          return 'moderate';
        if (riskStr.includes('low')) return 'low';
        return 'moderate';
      }

      // Initialize
      document.addEventListener('DOMContentLoaded', () => {
        fetchFunds();
        setupFilters();
      });

      function setupFilters() {
        // Filter tabs
        document.querySelectorAll('.filter-btn').forEach((btn) => {
          btn.addEventListener('click', () => {
            document
              .querySelectorAll('.filter-btn')
              .forEach((b) => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilter = btn.dataset.filter;
            renderFunds();
          });
        });

        // Category pills
        document.querySelectorAll('.category-pill').forEach((pill) => {
          pill.addEventListener('click', () => {
            document
              .querySelectorAll('.category-pill')
              .forEach((p) => p.classList.remove('active'));
            pill.classList.add('active');
            currentCategory = pill.dataset.category;
            renderFunds();
          });
        });
      }

      function renderFunds() {
        let funds = [...allFunds];

        // Apply top filter
        if (currentFilter === 'top25') {
          funds = funds.slice(0, 25);
        } else if (currentFilter === 'top50') {
          funds = funds.slice(0, 50);
        } else if (currentFilter === 'top100') {
          funds = funds.slice(0, 100);
        }

        // Apply category filter
        if (currentCategory !== 'all') {
          funds = funds.filter((f) => f.category === currentCategory);
        }

        // Update stats
        updateStats(funds);

        // Render fund cards
        const fundList = document.getElementById('fundList');

        if (funds.length === 0) {
          fundList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><i class="bi bi-inbox"></i></div>
                        <div class="empty-text">No funds found matching your criteria</div>
                    </div>
                `;
          return;
        }

        fundList.innerHTML = funds
          .map(
            (fund) => `
                <div class="fund-card">
                    <div class="fund-name">${fund.name}</div>
                    <div class="fund-type">${fund.type}</div>
                    
                    <span class="risk-badge risk-${
                      fund.riskLevel
                    }">${fund.riskLevel.toUpperCase()} RISK</span>
                    
                    <div class="fund-metrics">
                        <div class="metric">
                            <div class="metric-label">NAV</div>
                            <div class="metric-value">â‚¹${fund.nav.toFixed(
                              2
                            )}</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">1Y Return</div>
                            <div class="metric-value positive">${
                              fund.return1Y
                            }%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">3Y Return</div>
                            <div class="metric-value positive">${
                              fund.return3Y
                            }%</div>
                        </div>
                        <div class="metric">
                            <div class="metric-label">Expense</div>
                            <div class="metric-value">${
                              fund.expenseRatio
                            }%</div>
                        </div>
                    </div>
                    
                    <div class="fund-actions">
                        <button class="action-btn primary" onclick="viewDetails('${
                          fund.id
                        }')">
                            <i class="bi bi-eye"></i> View Details
                        </button>
                        <button class="action-btn" onclick="compareFund('${
                          fund.id
                        }')">
                            <i class="bi bi-arrow-left-right"></i> Compare
                        </button>
                        <button class="action-btn" onclick="checkOverlap('${
                          fund.id
                        }')">
                            <i class="bi bi-diagram-3"></i> Overlap
                        </button>
                    </div>
                </div>
            `
          )
          .join('');
      }

      function updateStats(funds) {
        document.getElementById('totalFunds').textContent = funds.length;

        if (funds.length > 0) {
          const avgReturn = (
            funds.reduce((sum, f) => sum + f.return3Y, 0) / funds.length
          ).toFixed(1);
          document.getElementById('avgReturn').textContent = avgReturn + '%';
          document.getElementById('topPerformer').textContent =
            funds[0].return3Y + '%';
        } else {
          document.getElementById('avgReturn').textContent = '0%';
          document.getElementById('topPerformer').textContent = '-';
        }
      }

      function viewDetails(id) {
        window.location.href = `/funds/${id}`;
      }

      function compareFund(id) {
        window.location.href = `/compare?fund=${id}`;
      }

      function checkOverlap(id) {
        window.location.href = `/overlap?fund=${id}`;
      }
    </script>
  </body>
</html>
