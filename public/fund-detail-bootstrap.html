<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fund Details - MF Analyzer</title>

    <!-- Bootstrap 5.3.8 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background-color: #f9fafb;
        padding-top: 60px;
        padding-bottom: 80px;
      }

      .top-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background-color: #ffffff;
        border-bottom: 1px solid #e5e7eb;
        z-index: 1030;
        padding: 12px 16px;
      }

      .back-btn {
        background: none;
        border: none;
        padding: 8px;
        cursor: pointer;
        color: #6b7280;
      }

      .back-btn:hover {
        color: #2563eb;
      }

      .fund-header {
        background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        padding: 24px 20px;
        margin: -16px -16px 24px;
        border-radius: 0 0 16px 16px;
      }

      .fund-name-large {
        font-size: 20px;
        font-weight: 700;
        color: #111827;
        margin-bottom: 8px;
        line-height: 1.3;
      }

      .fund-category {
        font-size: 14px;
        color: #6b7280;
        margin-bottom: 16px;
      }

      .nav-value-large {
        font-size: 36px;
        font-weight: 700;
        color: #1e40af;
        margin-bottom: 4px;
      }

      .nav-change {
        font-size: 14px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        padding: 4px 12px;
        border-radius: 12px;
      }

      .nav-change.positive {
        background: #d1fae5;
        color: #065f46;
      }

      .nav-change.negative {
        background: #fee2e2;
        color: #991b1b;
      }

      .info-card {
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
      }

      .info-card-title {
        font-size: 16px;
        font-weight: 700;
        color: #111827;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .info-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid #f3f4f6;
      }

      .info-row:last-child {
        border-bottom: none;
      }

      .info-label {
        font-size: 14px;
        color: #6b7280;
      }

      .info-value {
        font-size: 14px;
        font-weight: 600;
        color: #111827;
        text-align: right;
      }

      .performance-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 16px;
        background: #ffffff;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
      }

      .perf-period {
        font-size: 12px;
        color: #9ca3af;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .perf-value {
        font-size: 24px;
        font-weight: 700;
        color: #059669;
      }

      .holding-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #f3f4f6;
      }

      .holding-item:last-child {
        border-bottom: none;
      }

      .holding-name {
        font-size: 14px;
        color: #111827;
        font-weight: 500;
      }

      .holding-weight {
        font-size: 14px;
        font-weight: 700;
        color: #2563eb;
      }

      .action-buttons {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: #ffffff;
        border-top: 1px solid #e5e7eb;
        padding: 12px 16px;
        z-index: 1020;
      }

      .btn-action {
        flex: 1;
        padding: 14px;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary-action {
        background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
        color: #ffffff;
      }

      .btn-primary-action:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
      }

      .btn-secondary-action {
        background: #ffffff;
        color: #374151;
        border: 1px solid #e5e7eb;
      }

      .btn-secondary-action:hover {
        background: #f9fafb;
      }

      @media (max-width: 767px) {
        .fund-name-large {
          font-size: 18px;
        }

        .nav-value-large {
          font-size: 28px;
        }
      }
    </style>
  </head>
  <body>
    <!-- STICKY HEADER -->
    <header class="top-header">
      <div class="d-flex align-items-center justify-content-between">
        <button class="back-btn" onclick="history.back()">
          <i class="bi bi-arrow-left" style="font-size: 20px"></i>
        </button>
        <span style="font-size: 16px; font-weight: 600; color: #111827"
          >Fund Details</span
        >
        <button class="back-btn" onclick="addToWatchlist()">
          <i class="bi bi-bookmark" style="font-size: 20px"></i>
        </button>
      </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="container-fluid px-3" style="max-width: 768px; margin: 0 auto">
      <!-- Fund Header -->
      <div class="fund-header">
        <h1 class="fund-name-large" id="fundName">Loading...</h1>
        <p class="fund-category" id="fundCategory">-</p>

        <div class="nav-value-large" id="navValue">-</div>
        <span class="nav-change positive" id="navChange">
          <i class="bi bi-caret-up-fill"></i> +0.00%
        </span>
      </div>

      <!-- Performance Section -->
      <div class="info-card">
        <div class="info-card-title">
          <i class="bi bi-graph-up-arrow"></i>
          Returns Performance
        </div>

        <div class="row g-3">
          <div class="col-4">
            <div class="performance-card">
              <div class="perf-period">1 Year</div>
              <div class="perf-value" id="return1Y">-</div>
            </div>
          </div>
          <div class="col-4">
            <div class="performance-card">
              <div class="perf-period">3 Years</div>
              <div class="perf-value" id="return3Y">-</div>
            </div>
          </div>
          <div class="col-4">
            <div class="performance-card">
              <div class="perf-period">5 Years</div>
              <div class="perf-value" id="return5Y">-</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Fund Information -->
      <div class="info-card">
        <div class="info-card-title">
          <i class="bi bi-info-circle"></i>
          Fund Information
        </div>

        <div class="info-row">
          <span class="info-label">Fund House</span>
          <span class="info-value" id="fundHouse">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Category</span>
          <span class="info-value" id="category">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Risk Level</span>
          <span class="info-value" id="riskLevel">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Expense Ratio</span>
          <span class="info-value" id="expenseRatio">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">AUM</span>
          <span class="info-value" id="aum">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Min. Investment</span>
          <span class="info-value" id="minInvestment">-</span>
        </div>
      </div>

      <!-- Top Holdings -->
      <div class="info-card">
        <div class="info-card-title">
          <i class="bi bi-briefcase"></i>
          Top 10 Holdings
        </div>

        <div id="holdingsList">
          <div class="text-center text-muted py-3">Loading holdings...</div>
        </div>
      </div>

      <!-- Fund Manager -->
      <div class="info-card">
        <div class="info-card-title">
          <i class="bi bi-person-badge"></i>
          Fund Manager
        </div>

        <div class="info-row">
          <span class="info-label">Name</span>
          <span class="info-value" id="managerName">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Experience</span>
          <span class="info-value" id="managerExp">-</span>
        </div>
      </div>
    </main>

    <!-- Fixed Action Buttons -->
    <div class="action-buttons">
      <div class="d-flex gap-2">
        <button class="btn-action btn-primary-action" onclick="investNow()">
          <i class="bi bi-wallet2"></i> Invest Now
        </button>
        <button class="btn-action btn-secondary-action" onclick="compareFund()">
          <i class="bi bi-arrow-left-right"></i> Compare
        </button>
      </div>
    </div>

    <!-- Bootstrap 5.3.8 JS -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>

    <script>
      // API Configuration
      const API_URL = 'http://localhost:3002/api';

      // Get fund ID from URL
      const urlParams = new URLSearchParams(window.location.search);
      const fundId = urlParams.get('id');

      // Load fund details from API
      document.addEventListener('DOMContentLoaded', () => {
        if (!fundId) {
          showError('No fund ID provided');
          return;
        }
        fetchFundDetails();
      });

      async function fetchFundDetails() {
        try {
          const response = await fetch(`${API_URL}/funds/${fundId}`);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          const result = await response.json();
          const fund = result.data || result; // Handle wrapped response
          loadFundDetails(fund);
        } catch (error) {
          console.error('Error fetching fund details:', error);
          showError(
            'Unable to load fund details. Please ensure the backend server is running.'
          );
        }
      }

      function showError(message) {
        document.querySelector('.container').innerHTML = `
          <div class="alert alert-danger mt-5" role="alert">
            <i class="bi bi-exclamation-triangle"></i> ${message}
          </div>
        `;
      }

      function loadFundDetails(fund) {
        // Populate header
        document.getElementById('fundName').textContent = fund.name || 'N/A';
        document.getElementById('fundCategory').textContent =
          fund.subCategory || fund.category || 'N/A';

        const nav = fund.currentNav || fund.navValue || fund.nav || 0;
        document.getElementById('navValue').textContent = `₹${nav.toFixed(2)}`;

        const navChange = document.getElementById('navChange');
        const prevNav = fund.previousNav || fund.currentNav || nav;
        const change = prevNav ? ((nav - prevNav) / prevNav) * 100 : 0;
        const isPositive = change >= 0;
        navChange.className = `nav-change ${
          isPositive ? 'positive' : 'negative'
        }`;
        navChange.innerHTML = `
          <i class="bi bi-caret-${isPositive ? 'up' : 'down'}-fill"></i>
          ${isPositive ? '+' : ''}${change.toFixed(2)}%
        `;

        // Populate returns
        document.getElementById('return1Y').textContent = `${(
          fund.returns?.oneYear ||
          fund.returns?.['1Y'] ||
          fund.return1Y ||
          0
        ).toFixed(2)}%`;
        document.getElementById('return3Y').textContent = `${(
          fund.returns?.threeYear ||
          fund.returns?.['3Y'] ||
          fund.return3Y ||
          0
        ).toFixed(2)}%`;
        document.getElementById('return5Y').textContent = `${(
          fund.returns?.fiveYear ||
          fund.returns?.['5Y'] ||
          fund.return5Y ||
          0
        ).toFixed(2)}%`;

        // Populate info
        document.getElementById('fundHouse').textContent =
          fund.fundHouse || fund.amc || 'N/A';
        document.getElementById('category').textContent =
          fund.subCategory || fund.category || 'N/A';
        document.getElementById('riskLevel').textContent =
          fund.riskLevel || fund.risk || 'Moderate';
        document.getElementById('expenseRatio').textContent = `${(
          fund.expenseRatio || 0
        ).toFixed(2)}%`;
        document.getElementById('aum').textContent = `₹${(
          fund.aum || 0
        ).toLocaleString()} Cr`;
        document.getElementById('minInvestment').textContent = `₹${(
          fund.minInvestment || 5000
        ).toLocaleString()}`;

        // Populate manager
        const manager = fund.manager || fund.fundManager || {};
        document.getElementById('managerName').textContent =
          manager.name || 'N/A';
        document.getElementById('managerExp').textContent =
          manager.experience || 'N/A';

        // Populate holdings
        const holdings = fund.holdings || fund.topHoldings || [];
        const holdingsList = document.getElementById('holdingsList');

        if (holdings.length > 0) {
          holdingsList.innerHTML = holdings
            .slice(0, 10)
            .map(
              (holding) => `
              <div class="holding-item">
                <span class="holding-name">${
                  holding.name || holding.company || 'N/A'
                }</span>
                <span class="holding-weight">${(
                  holding.weight ||
                  holding.percentage ||
                  0
                ).toFixed(2)}%</span>
              </div>
            `
            )
            .join('');
        } else {
          holdingsList.innerHTML =
            '<p class="text-muted">No holdings data available</p>';
        }
      }

      function addToWatchlist() {
        alert('Added to watchlist!');
      }

      function investNow() {
        window.location.href = `/invest/${fundId}`;
      }

      function compareFund() {
        window.location.href = `/compare?fund=${fundId}`;
      }
    </script>
  </body>
</html>
